<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Surprises</title>
<style>
  html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
  body {
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #ffdde1, #ee9ca7);
    transition: background 1s ease;
    perspective: 1000px;
  }
  body.celebrate { background: radial-gradient(circle at top, #ff9a9e, #fad0c4); }

  #floatBg {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }
  .float-item {
    position: absolute;
    opacity: 0.18;
    mix-blend-mode: multiply;
    font-size: 56px;
    line-height: 1;
    animation: floatDrift 20s ease-in-out infinite;
  }
  .float-item:nth-child(odd) { animation-direction: alternate-reverse; }
  .float-item:nth-child(3n) { animation-duration: 25s; animation-delay: -5s; }
  .float-item:nth-child(5n) { animation-duration: 18s; animation-delay: -2s; }
  @keyframes floatDrift {
    0%, 100% { transform: translate(-50%, -50%) translate(0, 0) rotate(0deg); }
    25% { transform: translate(-50%, -50%) translate(15px, -20px) rotate(5deg); }
    50% { transform: translate(-50%, -50%) translate(-10px, 10px) rotate(-3deg); }
    75% { transform: translate(-50%, -50%) translate(20px, 15px) rotate(2deg); }
  }

  canvas {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 10;
  }

  .screen {
    position: relative;
    z-index: 5;
    text-align: center;
    padding: 20px;
  }
  .screen.hidden { display: none !important; }

  #startScreen h1 { color: #333; margin-bottom: 12px; }
  #startScreen p { color: #666; margin-bottom: 24px; }
  .start-btn {
    padding: 14px 32px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
  }
  .start-btn:hover { background: #e84393; }

  #cardsScreen { width: 100%; max-width: 580px; }
  .jackpot-cards {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 14px;
    min-height: 140px;
    width: 100%;
  }
  .jackpot-cards {
    transition: none;
  }
  .jackpot-cards.stacked .jackpot-card {
    position: absolute;
    left: 50%;
    top: 50%;
    margin: 0;
    transform: translate(-50%, -50%);
    transition: transform 0.6s ease-out, opacity 0.4s ease;
  }
  .jackpot-cards .jackpot-card {
    transition: transform 0.5s ease, opacity 0.4s ease;
  }
  .jackpot-cards .jackpot-card.splitting {
    position: absolute;
    transition: left 0.7s ease-out, top 0.7s ease-out, transform 0.7s ease-out;
  }
  .jackpot-cards:not(.stacked) .jackpot-card.split-done {
    position: relative;
    left: auto !important;
    top: auto !important;
    transform: none !important;
  }
  .jackpot-card {
    width: 90px;
    height: 126px;
    cursor: pointer;
    transition: transform 0.5s ease, opacity 0.4s ease;
  }
  .jackpot-card.hide {
    opacity: 0;
    pointer-events: none;
    transform: scale(0.5);
  }
  .jackpot-card.spin-out {
    animation: spinDisappear 0.8s ease forwards;
    pointer-events: none;
  }
  @keyframes spinDisappear {
    0% { transform: translate(-50%, -50%) scale(2.4) rotate(0deg); opacity: 1; }
    70% { transform: translate(-50%, -50%) scale(2.4) rotate(1080deg); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0) rotate(1080deg); opacity: 0; }
  }
  .jackpot-card.grown {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 140px;
    height: 190px;
    transform: translate(-50%, -50%) scale(2.4);
    z-index: 8;
    cursor: default;
  }
  .jackpot-card .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
  }
  .jackpot-card.flipped .card-inner { transform: rotateY(180deg); }
  .card-back, .card-front {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  .card-back {
    background: linear-gradient(145deg, #e84393, #fd79a8);
    color: white;
    font-size: 28px;
    font-weight: normal;
  }
  .card-front {
    background: rgba(255,255,255,0.98);
    background-size: cover;
    background-position: center;
    transform: rotateY(180deg);
    padding: 12px;
    overflow: hidden;
    flex-direction: column;
    justify-content: space-between;
    color: #333;
  }
  .card-front::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.75);
    border-radius: 12px;
    pointer-events: none;
  }
  .card-front h2, .card-front p, .card-front .continue-btn {
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 2px rgba(255,255,255,0.9);
  }
  .card-front h2 { color: #ff4d6d; margin: 0 0 4px; font-size: 1rem; }
  .card-front p { margin: 0 0 6px; font-size: 0.85rem; }
  .card-front .continue-btn, .card-front .proposal-yes, .card-front .proposal-no {
    padding: 8px 16px;
    border: none;
    border-radius: 24px;
    font-size: 13px;
    cursor: pointer;
    margin-top: 6px;
  }
  .continue-btn {
    background: #e84393;
    color: white;
    font-weight: 600;
    box-shadow: 0 3px 12px rgba(232, 67, 147, 0.4);
    transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
  }
  .continue-btn:hover {
    background: #ff4d6d;
    box-shadow: 0 4px 16px rgba(255, 77, 109, 0.45);
    transform: scale(1.05);
  }
  .proposal-yes { background: #ff4d6d; color: white; }
  .proposal-no { background: #f1f1f1; position: absolute; }

  #revealArea {
    display: none;
    position: relative;
    z-index: 7;
    max-width: 380px;
    margin: 0 auto;
    background: rgba(255,255,255,0.96);
    padding: 32px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  }
  #revealArea.visible { display: block; }
  #revealArea.summary-view {
    max-width: 540px;
  }
  #revealArea .final-summary-wrap {
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    gap: 24px;
  }
  #revealArea .final-summary-content {
    flex: 1;
    min-width: 0;
  }
  #revealArea .final-summary-content h1 { color: #333; }
  #revealArea .final-summary-content h2 { color: #ff4d6d; }
  #revealArea .final-summary-valentine-img {
    display: block;
    width: 100%;
    max-width: 110px;
    height: auto;
    margin: 12px auto 16px;
    transform: translateX(-60px);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    object-fit: cover;
  }
  #revealArea .summary-winnings-row {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 16px;
    margin: 20px 0 0;
  }
  #revealArea .summary-winnings-left { flex: 1; min-width: 0; }
  #revealArea .summary-winnings-right {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #revealArea .final-summary-bear-gif {
    display: block;
    max-width: 100px;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    object-fit: contain;
  }
  #revealArea .winnings-list { text-align: left; margin: 0; padding-left: 24px; }
  #revealArea .winnings-list li { margin: 8px 0; color: #555; }
  #revealArea .last-page {
    margin-top: 32px;
    padding-top: 28px;
    border-top: 2px solid rgba(255, 77, 109, 0.35);
    text-align: center;
  }
  #revealArea .last-page .last-line {
    font-size: 1.35rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 8px;
    letter-spacing: 0.02em;
  }
  #revealArea .last-page .last-underline {
    display: block;
    width: 80px;
    height: 3px;
    margin: 0 auto;
    background: linear-gradient(90deg, transparent, #ff4d6d, transparent);
    border: none;
    border-radius: 2px;
  }
  /* ---------- Flower vase + falling petals (moonshine-style) ---------- */
  .last-page-vase {
    --vase-glass: linear-gradient(to left, #142544, #1a9092);
    --vase-water: linear-gradient(to left, #142544, #1b6d6e);
    position: relative;
    flex-shrink: 0;
    min-height: 200px;
    margin-top: 0;
    padding-top: 0;
    background: transparent;
    transform: translateX(-18px);
  }
  .last-page-vase .flower {
    position: relative;
    display: block;
    width: 20vmin;
    margin: 0 auto;
    min-height: 50vmin;
    overflow: visible;
  }
  .last-page-vase .flower__glass {
    width: 20vmin;
    height: 30vmin;
    background-image: var(--vase-glass);
    clip-path: polygon(0 0, 100% 0, 85% 100%, 15% 100%);
    opacity: 0.9;
    position: relative;
    margin: 0 auto;
    transform: translateY(20vmin);
  }
  .last-page-vase .flower__glass::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    background-color: #182843;
    width: 100%;
    height: 2vmin;
  }
  .last-page-vase .flower__glass::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    background-image: var(--vase-water);
    width: 100%;
    height: 15vmin;
  }
  .last-page-vase .f-wrapper {
    position: absolute;
    left: 45%;
    bottom: 2vmin;
  }
  .last-page-vase .f-wrapper--2 {
    left: 50%;
    bottom: 5%;
    transform-origin: 10% left;
    transform: rotate(20deg);
  }
  .last-page-vase .f-wrapper--3 {
    left: 30%;
    bottom: 5%;
    transform-origin: 10% left;
    transform: rotate(-10deg);
  }
  .last-page-vase .f-wrapper--3 .flower__line { height: 45vmin; position: relative; }
  .last-page-vase .f-wrapper--3 .flower__line::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 6vmin;
    height: 6vmin;
    transform: translate(-69%, -30%) rotate(-5deg);
    border-radius: 10vmin 10vmin 0 0;
    border: 2vmin solid #104d4e;
    border-bottom: transparent;
    border-left: transparent;
  }
  .last-page-vase .f-wrapper--3 .flower__line::before {
    content: '';
    position: absolute;
    left: -40%;
    top: -1%;
    width: 6vmin;
    height: 2vmin;
    transform-origin: right;
    transform: translate(-100%, -80%) rotate(-20deg);
    background-color: #104d4e;
    border-radius: 2vmin;
  }
  .last-page-vase .f-wrapper--3 .flower__line {
    background-image: linear-gradient(to top, #142544, #104d4e);
  }
  .last-page-vase .f-wrapper--2 .flower__line { height: 45vmin; }
  .last-page-vase .f-wrapper--2 .f { transform: translateX(-50%) rotate(20deg); }
  .last-page-vase .f-wrapper--3 .f { transform: translate(-350%, -50%) rotate(-120deg); }
  .last-page-vase .f-wrapper--2 .flower__leaf:not(:first-child) {
    width: 3.8vmin;
    height: 10vmin;
    background-image: linear-gradient(to bottom, #ff43b6, #c22887, #1a233a 99%);
  }
  .last-page-vase .f-wrapper--3 .flower__leaf:not(:first-child) {
    width: 3.8vmin;
    height: 10vmin;
    background-image: linear-gradient(to bottom, #ad2be0, #712291, #1a233a 99%);
  }
  .last-page-vase .f-wrapper--3 .flower__leaf--1 {
    width: 8vmin;
    height: 10vmin;
    bottom: 2vmin;
    background-color: #ad2be0;
  }
  .last-page-vase .f-wrapper--2 .flower__leaf--1 {
    width: 8vmin;
    height: 10vmin;
    bottom: 2vmin;
    background-color: #de118b;
  }
  .last-page-vase .f-wrapper--2 .f .flower__leaf--8 {
    width: 10vmin;
    height: 9vmin;
    bottom: 3vmin;
    left: -30%;
    transform: rotate(-50deg);
    background-image: linear-gradient(to left bottom, #ff43b6, #4d1337);
  }
  .last-page-vase .f-wrapper--3 .f .flower__leaf--8 {
    width: 10vmin;
    height: 9vmin;
    left: -10% !important;
    background-image: linear-gradient(to left bottom, #ad2be0, #712291);
  }
  .last-page-vase .flower__line {
    width: 2vmin;
    height: 56vmin;
    background-image: linear-gradient(to left top, #82fdff 20%, #142544, #104d4e);
    border-radius: 4vmin;
  }
  .last-page-vase .f {
    position: absolute;
    top: 1vmin;
    left: 50%;
    transform: translateX(-50%) rotate(-10deg);
    width: 2vmin;
    height: 2vmin;
  }
  .last-page-vase .flower__leaf {
    position: absolute;
    left: 50%;
    bottom: 2vmin;
    transform: translateX(-50%);
    width: 5vmin;
    height: 14vmin;
    background-image: linear-gradient(to bottom, #ffa085, #fa7373, #1a233a 99%);
    clip-path: ellipse(50% 50% at 50% 50%);
    transform-origin: center bottom;
    animation: vase-open-flower 2s 1s backwards;
  }
  .last-page-vase .flower__leaf--1 {
    width: 10vmin;
    height: 12vmin;
    bottom: 3vmin;
    border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
    background-color: #e24f5f;
    background-image: none;
    animation: vase-open-middle 1.4s 1s backwards;
  }
  .last-page-vase .flower__leaf--2 { transform: translateX(-50%) rotate(-30deg); }
  .last-page-vase .flower__leaf--3 { transform: translateX(-50%) rotate(-50deg); }
  .last-page-vase .flower__leaf--4 { transform: translateX(-50%) rotate(-70deg); }
  .last-page-vase .flower__leaf--5 { transform: translateX(-50%) rotate(30deg); }
  .last-page-vase .flower__leaf--6 { transform: translateX(-50%) rotate(50deg); }
  .last-page-vase .flower__leaf--7 { transform: translateX(-50%) rotate(70deg); }
  .last-page-vase .flower__leaf--8 {
    width: 13vmin;
    height: 11vmin;
    bottom: 6vmin;
    left: -30%;
    border-radius: 10vmin 2vmin 10vmin 2vmin;
    transform: rotate(-55deg);
    background-image: linear-gradient(to left bottom, #ffa085, #eb8b8b, #492f2f 98%);
    clip-path: none;
  }
  .last-page-vase .flower__fall-down--yellow {
    animation: vase-fall-yellow 8s 1.2s linear forwards;
  }
  .last-page-vase .flower__fall-down--pink {
    animation: vase-fall-pink 5s 1.2s linear forwards;
  }
  .last-page-vase .flower__fall-down--purple {
    bottom: 4vmin;
    animation: vase-fall-purple 6s 1.2s linear forwards, vase-fall-loop 6s 7.2s linear infinite;
  }
  @keyframes vase-open-flower {
    0% { transform: translateX(-50%) rotate(0); }
  }
  @keyframes vase-open-middle {
    0% { opacity: 0; transform: translateX(-50%) scale(0); }
  }
  @keyframes vase-fall-pink {
    0% { transform: rotate(-55deg); }
    50% { transform: rotateX(-100deg); }
    100% { transform: translate(2vmin, 28vmin); }
  }
  @keyframes vase-fall-yellow {
    0% { transform: rotate(-55deg); }
    50% { bottom: 3vmin; transform: rotateX(-100deg); }
    100% { transform: translate(2vmin, 70vmin) rotate(150deg); }
  }
  @keyframes vase-fall-purple {
    0% { transform: rotate(-50deg); }
    25% { bottom: 1vmin; transform: rotateX(-100deg); perspective: 0px; }
    50% { perspective: 0px; transform: translate(-30vmin, 2vmin) rotate(90deg); }
    75% { perspective: 0px; transform: translate(-34vmin, -2vmin); }
    100% { transform-origin: center; transform: translate(-34vmin, -2vmin) rotateY(-80deg) rotateX(35deg); }
  }
  @keyframes vase-fall-loop {
    0%, 100% { transform-origin: center; transform: translate(-34vmin, -2vmin) rotateY(-80deg) rotateX(35deg); }
    25% { transform-origin: center; transform: translate(-34.4vmin, -2vmin) rotateY(-84deg) rotateX(35deg); }
    50% { transform-origin: center; transform: translate(-32vmin, -4.2vmin) rotateY(-80deg) rotateX(35deg); }
    75% { transform-origin: center; transform: translate(-36vmin, 1.1vmin) rotateY(-80deg) rotateX(35deg); }
  }
  #revealArea .proposal-image-wrap {
    margin: 14px 0 18px;
    text-align: center;
  }
  #revealArea .proposal-shy-img {
    max-width: 140px;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    display: block;
    margin: 0 auto;
  }
  #revealArea .buttons { position: relative; margin-top: 20px; height: 56px; }
  #revealArea .buttons button { padding: 12px 24px; border-radius: 30px; border: none; font-size: 16px; cursor: pointer; }
  #revealArea #yesBtn { background: #ff4d6d; color: white; }
  #revealArea #noBtn { background: #f1f1f1; position: absolute; }
  .buttons-wrap { position: relative; margin-top: 20px; height: 56px; }

  /* ---------- Message screen (ValentineWish-style) ---------- */
  #messageScreen {
    position: relative;
    z-index: 5;
    width: 100%;
    max-width: 420px;
    margin: 0 auto;
    padding: 24px;
    text-align: center;
  }
  #messageScreen .message-card {
    background: rgba(255,255,255,0.96);
    padding: 36px 28px;
    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.12);
  }
  #messageScreen .greeting {
    font-size: 1.75rem;
    color: #333;
    margin: 0 0 8px;
    opacity: 0;
    animation: msgFadeIn 0.6s ease forwards;
  }
  #messageScreen .subline {
    font-size: 1rem;
    color: #666;
    margin: 0 0 24px;
    opacity: 0;
    animation: msgFadeIn 0.6s ease 0.2s forwards;
  }
  #messageScreen .message-body {
    text-align: left;
    margin: 20px 0 28px;
    line-height: 1.7;
    color: #444;
  }
  #messageScreen .message-body p {
    margin: 0 0 14px;
  }
  #messageScreen .message-body .msg-word,
  #messageScreen .special .msg-word {
    display: inline;
    opacity: 0;
    animation: msgWordIn 0.5s ease forwards;
    white-space: pre;
  }
  #messageScreen .special {
    font-size: 1.4rem;
    font-weight: 600;
    color: #ff4d6d;
    margin: 16px 0 24px;
  }
  #messageScreen .special .msg-word { animation: msgWordIn 0.5s ease forwards; }
  #messageScreen .msg-cta {
    padding: 14px 32px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s;
    opacity: 0;
    animation: msgFadeIn 0.5s ease forwards;
  }
  #messageScreen .msg-cta:hover { background: #e84393; transform: scale(1.02); }

  /* ---------- Emoji rush from bottom (ValentineWish-style) ---------- */
  #emojiRushScreen {
    position: fixed;
    inset: 0;
    z-index: 6;
    overflow: hidden;
    pointer-events: none;
    display: none;
  }
  #emojiRushScreen.visible {
    display: block;
  }
  #emojiRushContainer {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 100%;
    pointer-events: none;
  }
  .emoji-rush-item {
    position: absolute;
    bottom: -0.3em;
    font-size: 4rem;
    line-height: 1;
    opacity: 0;
    animation: emojiRushUp 2.2s ease-out forwards;
    text-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  @keyframes emojiRushUp {
    0% {
      transform: translateY(0) scale(0.5);
      opacity: 0.85;
    }
    15% {
      opacity: 0.95;
    }
    100% {
      transform: translateY(-130vh) scale(1.1);
      opacity: 0.25;
    }
  }

  @keyframes msgFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes msgWordIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div id="floatBg" aria-hidden="true"></div>
<canvas id="canvas"></canvas>

<div id="messageScreen" class="screen">
  <div class="message-card">
    <h1 class="greeting" id="msgGreeting">Hey you!</h1>
    <p class="subline" id="msgSubline">Happy Valentine's Day ‚ù§Ô∏è</p>
    <div class="message-body" id="msgBody">
      <p>I wanted to do something special.</p>
      <p>Because,</p>
      <p>you deserve more than just words.</p>
      <p>So I made you a little game of surprises.</p>
    </div>
    <p class="special" id="msgSpecial">You are special üíï</p>
    <button type="button" class="msg-cta" id="msgCtaBtn">Open your surprises</button>
  </div>
</div>

<div id="emojiRushScreen">
  <div id="emojiRushContainer"></div>
</div>

<div id="startScreen" class="screen hidden">
  <h1>Hey you!</h1>
  <p>I have a few surprises for you. Ready?</p>
  <button type="button" class="start-btn" id="startBtn">Open your surprises</button>
</div>

<div id="cardsScreen" class="screen hidden">
  <div id="cardsContainer" class="jackpot-cards"></div>
</div>

<div id="revealArea">
  <div id="revealContent"></div>
</div>

<script>
/* ---------- Canvas ---------- */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.onresize = function() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
};

/* ---------- Fireworks ---------- */
var rockets = [], particles = [], confetti = [];
var gravity = 0.06, MAX_PARTICLES = 400, MAX_ROCKETS_IN_FLIGHT = 4, rocketQueue = 0;
var fireworkColors = ['#ff4d6d', '#ff6b9d', '#ff9a9e', '#ffd93d', '#e84393', '#fd79a8', '#fdcb6e', '#ffffff'];
var confettiColors = ['#ff4d6d', '#ff6b9d', '#ffd93d', '#e84393', '#fd79a8', '#fff5e6', '#ffffff', '#ff9a9e'];

function createRocket() {
  if (rockets.length >= MAX_ROCKETS_IN_FLIGHT) { rocketQueue++; return; }
  var x = Math.random() * canvas.width * 0.6 + canvas.width * 0.2;
  rockets.push({ x: x, y: canvas.height, vx: (Math.random() - 0.5) * 2, vy: -Math.random() * 4 - 10, color: fireworkColors[Math.floor(Math.random() * fireworkColors.length)], trail: [] });
}
function explodeRocket(r) {
  if (particles.length >= MAX_PARTICLES) return;
  for (var i = 0; i < 35; i++) {
    var angle = Math.random() * Math.PI * 2, speed = Math.random() * 4 + 3;
    particles.push({ x: r.x, y: r.y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, radius: 1.5, life: 60 + Math.random() * 40, maxLife: 100, color: fireworkColors[Math.floor(Math.random() * fireworkColors.length)] });
  }
  for (var i = 0; i < 15; i++) {
    var angle = Math.random() * Math.PI * 2, speed = Math.random() * 6 + 4;
    particles.push({ x: r.x, y: r.y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, radius: 1, life: 40 + Math.random() * 30, maxLife: 70, color: '#ffffff' });
  }
}
function burstPartyPopper(cx, cy) {
  for (var i = 0; i < 60; i++) {
    var angle = Math.random() * Math.PI * 2, speed = Math.random() * 8 + 6;
    confetti.push({ x: cx, y: cy, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed - 2, w: 4 + Math.random() * 6, h: 2 + Math.random() * 4, color: confettiColors[Math.floor(Math.random() * confettiColors.length)], rot: Math.random() * 360, rotSpeed: (Math.random() - 0.5) * 20, life: 120 + Math.random() * 60, maxLife: 180 });
  }
}
function tick() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (rocketQueue > 0 && rockets.length < MAX_ROCKETS_IN_FLIGHT) { rocketQueue--; createRocket(); }
  for (var i = rockets.length - 1; i >= 0; i--) {
    var r = rockets[i];
    r.trail.push({ x: r.x, y: r.y }); if (r.trail.length > 8) r.trail.shift();
    r.x += r.vx; r.y += r.vy; r.vy += 0.12;
    ctx.strokeStyle = r.color; ctx.lineWidth = 2; ctx.beginPath();
    r.trail.forEach(function(t, j) { if (j === 0) ctx.moveTo(t.x, t.y); else ctx.lineTo(t.x, t.y); });
    ctx.globalAlpha = 0.6; ctx.stroke(); ctx.globalAlpha = 1;
    ctx.fillStyle = r.color; ctx.beginPath(); ctx.arc(r.x, r.y, 2.5, 0, Math.PI * 2); ctx.fill();
    if (r.vy >= 0) { explodeRocket(r); rockets.splice(i, 1); }
  }
  for (var i = particles.length - 1; i >= 0; i--) {
    var p = particles[i];
    p.x += p.vx; p.y += p.vy; p.vy += gravity; p.vx *= 0.98; p.vy *= 0.98; p.life--;
    var alpha = p.life / p.maxLife, rad = Math.max(0.3, p.radius * alpha);
    ctx.globalAlpha = alpha; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, rad, 0, Math.PI * 2); ctx.fill(); ctx.globalAlpha = 1;
    if (p.life <= 0) particles.splice(i, 1);
  }
  for (var i = confetti.length - 1; i >= 0; i--) {
    var c = confetti[i];
    c.x += c.vx; c.y += c.vy; c.vy += 0.08; c.vx *= 0.99; c.vy *= 0.99; c.rot += c.rotSpeed; c.life--;
    var alpha = c.life / c.maxLife;
    ctx.save(); ctx.translate(c.x, c.y); ctx.rotate(c.rot * Math.PI / 180); ctx.globalAlpha = alpha; ctx.fillStyle = c.color; ctx.fillRect(-c.w / 2, -c.h / 2, c.w, c.h); ctx.restore();
    if (c.life <= 0) confetti.splice(i, 1);
  }
  requestAnimationFrame(tick);
}
tick();

/* ---------- Music ---------- */
var audio = new Audio();
audio.loop = true; audio.volume = 0.7; audio.preload = 'auto';
var musicUrls = ['emotional-piano.mp3', 'https://cdn.pixabay.com/audio/2022/08/04/audio_381a7f2d2c.mp3', 'https://cdn.pixabay.com/audio/2022/05/27/audio_306c755a2f.mp3'];
var audioCtx = null, fallbackPlaying = false;
function playFallbackMusic() {
  if (fallbackPlaying) return;
  fallbackPlaying = true;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  var notes = [261.63, 293.66, 329.63, 349.23, 392, 440, 493.88, 523.25], melody = [0, 2, 4, 2, 0, 4, 5, 4, 2, 4, 2, 0, 0, 2, 2, 4, 4, 5, 4, 2, 0], i = 0;
  function playNote() {
    if (i >= melody.length) i = 0;
    var osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
    osc.type = 'sine'; osc.frequency.value = notes[melody[i]];
    gain.gain.setValueAtTime(0.12, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
    osc.connect(gain); gain.connect(audioCtx.destination); osc.start(audioCtx.currentTime); osc.stop(audioCtx.currentTime + 0.45);
    i++; if (fallbackPlaying) setTimeout(playNote, 380);
  }
  playNote();
}
function playMusic() {
  function tryUrl(idx) {
    if (idx >= musicUrls.length) { playFallbackMusic(); return; }
    audio.src = musicUrls[idx]; audio.load();
    audio.play().then(function() {}).catch(function() { tryUrl(idx + 1); });
  }
  tryUrl(0);
}

/* ---------- Message screen config (edit this to personalize) ---------- */
var MESSAGE_CONFIG = {
  name: 'you',
  greeting: "Hey you!",
  subline: "Happy Valentine's Day ‚ù§Ô∏è",
  messageLines: [
    "I wanted to do something special.",
    "Because,",
    "you deserve more than just words.",
    "So I made you a little game of surprises."
  ],
  specialLine: "You are special üíï",
  ctaText: "Open your surprises",
  lastPageLine: "Thank you for being my girlfriend",
  proposalImage: "proposal-shy.png"
};

/* ---------- Jackpot flow ---------- */
var PRIZES = ['Flower', 'Sweet', 'Soft toy', 'Date night', 'Proposal'];
var PRIZE_IMAGES = ['flower.jpg', 'Sweet.jpg', 'soft_toys.jpg', 'Date_night.jpg'];
var prizeIndex = 0;
var revealing = false;
var messageScreen = document.getElementById('messageScreen');
var emojiRushScreen = document.getElementById('emojiRushScreen');
var emojiRushContainer = document.getElementById('emojiRushContainer');
var startScreen = document.getElementById('startScreen');
var cardsScreen = document.getElementById('cardsScreen');
var cardsContainer = document.getElementById('cardsContainer');
var revealArea = document.getElementById('revealArea');
var revealContent = document.getElementById('revealContent');

(function initMessageScreen() {
  if (!messageScreen) return;
  var g = document.getElementById('msgGreeting');
  var s = document.getElementById('msgSubline');
  var b = document.getElementById('msgBody');
  var sp = document.getElementById('msgSpecial');
  var btn = document.getElementById('msgCtaBtn');
  if (g) g.textContent = MESSAGE_CONFIG.greeting;
  if (s) s.textContent = MESSAGE_CONFIG.subline;

  var wordDelaySec = 0.6;
  var startDelay = 0.5;
  var wordIndex = 0;

  function wrapWordsInSpans(text) {
    var parts = text.split(/(\s+)/);
    var html = '';
    for (var i = 0; i < parts.length; i++) {
      if (parts[i].match(/^\s+$/)) {
        html += parts[i];
      } else if (parts[i].length) {
        var delay = startDelay + wordIndex * wordDelaySec;
        wordIndex++;
        html += '<span class="msg-word" style="animation-delay:' + delay + 's">' + parts[i].replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</span>';
      }
    }
    return html;
  }

  if (b && MESSAGE_CONFIG.messageLines && MESSAGE_CONFIG.messageLines.length) {
    b.innerHTML = MESSAGE_CONFIG.messageLines.map(function(line) {
      return '<p>' + wrapWordsInSpans(line) + '</p>';
    }).join('');
  }

  if (sp && MESSAGE_CONFIG.specialLine) {
    sp.innerHTML = wrapWordsInSpans(MESSAGE_CONFIG.specialLine);
  }

  var ctaDelay = startDelay + wordIndex * wordDelaySec + 0.4;
  if (btn) {
    btn.textContent = MESSAGE_CONFIG.ctaText;
    btn.style.animationDelay = ctaDelay + 's';
    btn.addEventListener('click', function() {
      messageScreen.classList.add('hidden');
      showEmojiRushThenStart();
    });
  }
})();

var EMOJI_RUSH_SYMBOLS = ['‚ù§Ô∏è', 'üíï', 'üåπ', 'üéÅ', 'üíñ', 'üéà', 'üíó', 'üå∏', 'üíù', 'üå∑', 'ü´∂', 'üíì', 'üå∫', '‚ú®', 'üíû'];
function showEmojiRushThenStart() {
  if (!emojiRushScreen || !emojiRushContainer) {
    startScreen.classList.remove('hidden');
    return;
  }
  emojiRushContainer.innerHTML = '';
  var count = 28;
  var minSize = 3.5;
  var maxSize = 9;
  for (var i = 0; i < count; i++) {
    var el = document.createElement('span');
    el.className = 'emoji-rush-item';
    el.textContent = EMOJI_RUSH_SYMBOLS[Math.floor(Math.random() * EMOJI_RUSH_SYMBOLS.length)];
    el.style.left = (Math.random() * 92 + 2) + '%';
    el.style.fontSize = (minSize + Math.random() * (maxSize - minSize)).toFixed(1) + 'rem';
    el.style.animationDelay = (Math.random() * 0.5 + i * 0.04) + 's';
    emojiRushContainer.appendChild(el);
  }
  emojiRushScreen.classList.add('visible');
  setTimeout(function() {
    emojiRushScreen.classList.remove('visible');
    startScreen.classList.remove('hidden');
  }, 2800);
}

var FLOAT_TYPES = [{ sym: '‚ù§Ô∏è', name: 'heart' }, { sym: 'üåπ', name: 'rose' }, { sym: 'üß∏', name: 'teddy' }];
var FLOATS_PER_TYPE = 8;
(function initFloatingBg() {
  var container = document.getElementById('floatBg');
  if (!container) return;
  var basePositions = [
    [8, 15], [8, 35], [8, 55], [8, 75],
    [22, 22], [22, 42], [22, 62], [22, 82],
    [36, 18], [36, 38], [36, 58], [36, 78]
  ];
  var positions = [];
  basePositions.forEach(function(p) {
    positions.push({ left: p[0] + '%', top: p[1] + '%' });
    positions.push({ left: (100 - p[0]) + '%', top: p[1] + '%' });
  });
  var symbols = [];
  FLOAT_TYPES.forEach(function(t) {
    for (var i = 0; i < FLOATS_PER_TYPE; i++) symbols.push(t.sym);
  });
  for (var i = symbols.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var s = symbols[i]; symbols[i] = symbols[j]; symbols[j] = s;
  }
  var sizeBase = 56;
  for (var i = 0; i < positions.length; i++) {
    var el = document.createElement('span');
    el.className = 'float-item';
    el.textContent = symbols[i];
    el.style.left = positions[i].left;
    el.style.top = positions[i].top;
    el.style.fontSize = sizeBase + 'px';
    el.style.animationDelay = (Math.random() * -20) + 's';
    el.style.opacity = (0.12 + Math.random() * 0.12).toFixed(2);
    container.appendChild(el);
  }
})();

var CARD_EMOJIS = ['‚ù§Ô∏è', 'üíï', 'üåπ', 'üéÅ', 'üíñ'];
function shuffleArray(arr) {
  for (var i = arr.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var t = arr[i]; arr[i] = arr[j]; arr[j] = t;
  }
  return arr;
}

function renderCards(n) {
  var order = [];
  for (var i = 0; i < n; i++) order.push(i);
  shuffleArray(order);
  cardsContainer.innerHTML = '';
  cardsContainer.classList.add('stacked');
  for (var i = 0; i < n; i++) {
    var emoji = CARD_EMOJIS[Math.floor(Math.random() * CARD_EMOJIS.length)];
    var card = document.createElement('div');
    card.className = 'jackpot-card';
    card.dataset.order = order[i];
    card.innerHTML = '<div class="card-inner"><div class="card-back">' + emoji + '</div><div class="card-front"></div></div>';
    cardsContainer.appendChild(card);
  }
  var cardW = 90, cardH = 126;
  setTimeout(function() {
    var cards = cardsContainer.querySelectorAll('.jackpot-card');
    cards.forEach(function(c) { c.style.order = c.dataset.order; });
    cardsContainer.classList.remove('stacked');
    requestAnimationFrame(function() {
      var containerRect = cardsContainer.getBoundingClientRect();
      cardsContainer.style.minHeight = containerRect.height + 'px';
      var centerX = containerRect.width / 2 - cardW / 2;
      var centerY = containerRect.height / 2 - cardH / 2;
      var positions = [];
      cards.forEach(function(c) {
        var r = c.getBoundingClientRect();
        positions.push({
          left: r.left - containerRect.left,
          top: r.top - containerRect.top
        });
      });
      cards.forEach(function(c, i) {
        c.classList.add('splitting');
        c.style.left = centerX + 'px';
        c.style.top = centerY + 'px';
        c.style.transform = 'translate(-50%, -50%)';
      });
      requestAnimationFrame(function() {
        cards.forEach(function(c, i) {
          c.style.left = positions[i].left + 'px';
          c.style.top = positions[i].top + 'px';
          c.style.transform = 'translate(-50%, -50%)';
        });
        setTimeout(function() {
          cards.forEach(function(c) {
            c.classList.remove('splitting');
            c.classList.add('split-done');
            c.style.left = '';
            c.style.top = '';
            c.style.transform = '';
          });
          cardsContainer.style.minHeight = '';
        }, 720);
      });
    });
  }, 800);
}

function showStartScreen() {
  startScreen.classList.remove('hidden');
  cardsScreen.classList.add('hidden');
  revealArea.classList.remove('visible', 'summary-view');
}

function showCardsScreen() {
  startScreen.classList.add('hidden');
  cardsScreen.classList.remove('hidden');
  revealArea.classList.remove('visible', 'summary-view');
  var n = 5 - prizeIndex;
  if (n <= 0) return;
  renderCards(n);
}

function showReveal(html) {
  cardsScreen.classList.add('hidden');
  revealContent.innerHTML = html;
  revealArea.classList.remove('summary-view');
  revealArea.classList.add('visible');
}

function onContinue() {
  showCardsScreen();
}

function getProposalHTML() {
  var imgHtml = '';
  if (MESSAGE_CONFIG.proposalImage) {
    imgHtml = '<div class="proposal-image-wrap"><img src="' + MESSAGE_CONFIG.proposalImage.replace(/"/g, '&quot;') + '" alt="" class="proposal-shy-img" onerror="this.parentElement.style.display=\'none\'"></div>';
  }
  return '<h1>Hey You ‚ù§Ô∏è</h1><p>I was wondering something‚Ä¶</p><h2>Will you be my Valentine? üëâüëà</h2>' + imgHtml + '<div class="buttons"><button type="button" id="yesBtn">Yes üíñ</button><button type="button" id="noBtn">No üôÉ</button></div>';
}

function attachProposalListeners() {
  var noBtn = document.getElementById('noBtn');
  var yesBtn = document.getElementById('yesBtn');
  if (!noBtn || !yesBtn) return;
  noBtn.addEventListener('mouseover', function() {
    noBtn.style.transform = 'translate(' + (Math.random() * 200 - 100) + 'px, ' + (Math.random() * 200 - 100) + 'px)';
  });
  yesBtn.addEventListener('click', function() {
    document.body.classList.add('celebrate');
    playMusic();
    var cx = canvas.width / 2, cy = canvas.height / 2;
    burstPartyPopper(cx, cy);
    setTimeout(function() { burstPartyPopper(cx - 40, cy - 20); }, 150);
    setTimeout(function() { burstPartyPopper(cx + 30, cy - 10); }, 300);
    for (var i = 0; i < 45; i++) { setTimeout(function() { createRocket(); }, i * 600); }
    setTimeout(function() {
      cardsScreen.classList.add('hidden');
      var vaseHtml = '<div class="last-page-vase"><div class="flower">';
      vaseHtml += '<div class="f-wrapper"><div class="flower__line"></div><div class="f"><div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div><div class="flower__leaf flower__leaf--5"></div><div class="flower__leaf flower__leaf--6"></div><div class="flower__leaf flower__leaf--7"></div><div class="flower__leaf flower__leaf--8 flower__fall-down--yellow"></div></div></div>';
      vaseHtml += '<div class="f-wrapper f-wrapper--2"><div class="flower__line"></div><div class="f"><div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div><div class="flower__leaf flower__leaf--5"></div><div class="flower__leaf flower__leaf--6"></div><div class="flower__leaf flower__leaf--7"></div><div class="flower__leaf flower__leaf--8 flower__fall-down--pink"></div></div></div>';
      vaseHtml += '<div class="f-wrapper f-wrapper--3"><div class="flower__line"></div><div class="f"><div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div><div class="flower__leaf flower__leaf--5"></div><div class="flower__leaf flower__leaf--6"></div><div class="flower__leaf flower__leaf--7"></div><div class="flower__leaf flower__leaf--8 flower__fall-down--purple"></div></div></div>';
      vaseHtml += '<div class="flower__glass"></div></div></div>';
      var lastLine = (MESSAGE_CONFIG.lastPageLine != null) ? MESSAGE_CONFIG.lastPageLine : 'Thank you for being my girlfriend';
      var contentHtml = '<div class="final-summary-content"><h1>It\'s a YES!</h1><img src="Hehe.gif" alt="" class="final-summary-valentine-img" onerror="this.style.display=\'none\'"><div class="summary-winnings-row"><div class="summary-winnings-left"><h2>Your winnings</h2><ul class="winnings-list">';
      PRIZES.forEach(function(p) { contentHtml += '<li>' + p + '</li>'; });
      contentHtml += '</ul></div><div class="summary-winnings-right"><img src="https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif" alt="" class="final-summary-bear-gif" onerror="this.style.display=\'none\'"></div></div><div class="last-page"><p class="last-line">' + lastLine.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p><span class="last-underline"></span></div></div>';
      revealContent.innerHTML = '<div class="final-summary-wrap">' + vaseHtml + contentHtml + '</div>';
      revealArea.classList.add('visible', 'summary-view');
    }, 800);
  });
}

function showProposalScreen() {
  cardsScreen.classList.add('hidden');
  revealContent.innerHTML = getProposalHTML();
  revealArea.classList.remove('summary-view');
  revealArea.classList.add('visible');
  attachProposalListeners();
}

function onCardClick(e) {
  var card = e.target.closest('.jackpot-card');
  if (!card || revealing || card.classList.contains('flipped')) return;
  revealing = true;
  var prize = PRIZES[prizeIndex];
  var cards = cardsContainer.querySelectorAll('.jackpot-card');
  if (prize === 'Proposal') {
    cards.forEach(function(c) {
      if (c === card) {
        c.classList.add('grown', 'spin-out');
      } else {
        c.classList.add('hide');
      }
    });
    card.addEventListener('animationend', function once() {
      card.removeEventListener('animationend', once);
      prizeIndex++;
      showProposalScreen();
      revealing = false;
    }, { once: true });
    return;
  }
  cards.forEach(function(c) {
    if (c === card) {
      c.classList.add('flipped', 'grown');
    } else {
      c.classList.add('hide');
    }
  });
  var front = card.querySelector('.card-front');
  var inner = card.querySelector('.card-inner');
  var currentPrizeIndex = prizeIndex;
  inner.addEventListener('transitionend', function once() {
    inner.removeEventListener('transitionend', once);
    burstPartyPopper(canvas.width / 2, canvas.height / 2);
    setTimeout(function() { burstPartyPopper(canvas.width / 2 - 30, canvas.height / 2 - 20); }, 120);
    if (currentPrizeIndex < PRIZE_IMAGES.length) {
      front.style.backgroundImage = 'url(' + PRIZE_IMAGES[currentPrizeIndex] + ')';
    }
    front.innerHTML = '<h2>Hurray!</h2><p>You won: ' + prize + '</p><button type="button" class="continue-btn">Continue</button>';
    front.querySelector('.continue-btn').addEventListener('click', function() {
      showCardsScreen();
    });
    revealing = false;
  }, { once: true });
  prizeIndex++;
}

document.getElementById('startBtn').addEventListener('click', function() {
  prizeIndex = 0;
  showCardsScreen();
});

cardsContainer.addEventListener('click', onCardClick);
</script>
</body>
</html>
