<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Surprises</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Dancing+Script:wght@400;600&family=Fredoka:wght@400;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
  html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
  body {
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #ffdde1, #ee9ca7);
    transition: background 1s ease;
    perspective: 1000px;
  }
  body.celebrate { background: radial-gradient(circle at top, #ff9a9e, #fad0c4); }

  #floatBg {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }
  .float-item {
    position: absolute;
    opacity: 0.18;
    mix-blend-mode: multiply;
    font-size: 56px;
    line-height: 1;
    animation: floatDrift 20s ease-in-out infinite;
  }
  .float-item:nth-child(odd) { animation-direction: alternate-reverse; }
  .float-item:nth-child(3n) { animation-duration: 25s; animation-delay: -5s; }
  .float-item:nth-child(5n) { animation-duration: 18s; animation-delay: -2s; }
  @keyframes floatDrift {
    0%, 100% { transform: translate(-50%, -50%) translate(0, 0) rotate(0deg); }
    25% { transform: translate(-50%, -50%) translate(15px, -20px) rotate(5deg); }
    50% { transform: translate(-50%, -50%) translate(-10px, 10px) rotate(-3deg); }
    75% { transform: translate(-50%, -50%) translate(20px, 15px) rotate(2deg); }
  }

  canvas {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 10;
  }

  .screen {
    position: relative;
    z-index: 5;
    text-align: center;
    padding: 20px;
  }
  .screen.hidden { display: none !important; }

  #startScreen { font-family: 'Fredoka', sans-serif; }
  #startScreen .start-surprise-gif {
    display: block;
    width: 140px;
    height: auto;
    margin: 0 auto 20px;
    pointer-events: none;
  }
  #startScreen h1 { color: #333; margin-bottom: 12px; }
  #startScreen p { color: #666; margin-bottom: 24px; }
  .start-btn {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
    padding: 14px 32px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
  }
  .start-btn:hover { background: #e84393; }

  #cardsScreen { width: 100%; max-width: 420px; display: flex; flex-direction: column; align-items: center; gap: 20px; font-family: 'Fredoka', sans-serif; }
  .jackpot-cards {
    position: relative;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    width: 100%;
    max-width: 360px;
  }
  .jackpot-cards .jackpot-card {
    transition: transform 0.5s ease, opacity 0.4s ease;
  }
  .jackpot-card {
    width: 100%;
    aspect-ratio: 90 / 126;
    max-width: 160px;
    max-height: 224px;
    justify-self: center;
    cursor: pointer;
    transition: transform 0.5s ease, opacity 0.4s ease;
  }
  .jackpot-card .card-front.prize-faded { opacity: 0; transition: opacity 0.5s ease; }
  .jackpot-card .card-front.gf-quadrant {
    background-size: 200% 200%;
    background-color: transparent;
    transition: opacity 0.5s ease;
  }
  .jackpot-card .card-front.gf-quadrant::before { display: none; }
  .jackpot-card .card-front.gf-quadrant .card-front-inner { display: none; }
  .jackpot-card .card-front.gf-quadrant.q0 { background-position: 0 0; }
  .jackpot-card .card-front.gf-quadrant.q1 { background-position: 100% 0; }
  .jackpot-card .card-front.gf-quadrant.q2 { background-position: 0 100%; }
  .jackpot-card .card-front.gf-quadrant.q3 { background-position: 100% 100%; }
  /* Cards coming together to form one big card */
  .jackpot-cards.cards-forming-one {
    transition: none;
  }
  .jackpot-cards.cards-forming-one .jackpot-card {
    position: absolute;
    transition: left 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94), top 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94), width 0.7s ease, height 0.7s ease;
    z-index: 2;
  }
  .continue-madness-btn {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    padding: 14px 28px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 16px rgba(255, 77, 109, 0.4);
    transition: background 0.2s, transform 0.15s, opacity 0.3s;
  }
  .continue-madness-btn:hover { background: #e84393; transform: scale(1.02); }
  .continue-madness-btn.hidden { display: none !important; }
  .jackpot-card .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
  }
  .jackpot-cards.flip-slow .jackpot-card .card-inner {
    transition-duration: 1.2s;
    transition-timing-function: ease-in-out;
  }
  .jackpot-card.flipped .card-inner { transform: rotateY(180deg); }
  .card-back, .card-front {
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  .card-back {
    background: linear-gradient(145deg, #e84393, #fd79a8);
    color: white;
    font-size: 28px;
    font-weight: normal;
  }
  .card-front {
    background: rgba(255,255,255,0.98);
    background-size: cover;
    background-position: center;
    transform: rotateY(180deg);
    padding: 12px;
    overflow: hidden;
    flex-direction: column;
    justify-content: space-between;
    color: #333;
  }
  .card-front::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.75);
    border-radius: 12px;
    pointer-events: none;
  }
  .card-front h2, .card-front p, .card-front .continue-btn {
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 2px rgba(255,255,255,0.9);
  }
  .card-front { font-family: 'Fredoka', sans-serif; }
  .card-front h2 { color: #ff4d6d; margin: 0 0 4px; font-size: 1rem; }
  .card-front p { margin: 0 0 6px; font-size: 0.85rem; }
  .card-front .continue-btn, .card-front .proposal-yes, .card-front .proposal-no {
    padding: 8px 16px;
    border: none;
    border-radius: 24px;
    font-size: 13px;
    cursor: pointer;
    margin-top: 6px;
  }
  .continue-btn {
    background: #e84393;
    color: white;
    font-weight: 600;
    box-shadow: 0 3px 12px rgba(232, 67, 147, 0.4);
    transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
  }
  .continue-btn:hover {
    background: #ff4d6d;
    box-shadow: 0 4px 16px rgba(255, 77, 109, 0.45);
    transform: scale(1.05);
  }
  .proposal-yes { background: #ff4d6d; color: white; }
  .proposal-no { background: #f1f1f1; position: absolute; }

  /* Quiz on card front */
  .card-quiz { position: relative; z-index: 1; text-align: center; padding: 4px 0; }
  .card-quiz .quiz-question { font-size: 0.9rem; color: #333; margin: 0 0 12px; font-weight: 600; line-height: 1.3; }
  .card-quiz .quiz-options { list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 8px; }
  .card-quiz .quiz-option {
    display: block; padding: 8px 12px; border-radius: 12px; font-size: 0.8rem;
    background: rgba(255, 77, 109, 0.12); color: #333; cursor: pointer;
    border: 2px solid transparent; transition: background 0.2s, border-color 0.2s;
  }
  .card-quiz .quiz-option:hover:not(.wrong) { background: rgba(255, 77, 109, 0.25); border-color: rgba(255, 77, 109, 0.4); }
  .card-quiz .quiz-option.wrong {
    text-decoration: line-through; pointer-events: none; color: #999; background: rgba(0,0,0,0.06);
  }
  @keyframes cardShake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }
  .jackpot-card.shake { animation: cardShake 0.4s ease-in-out; }

  #revealArea {
    display: none;
    position: relative;
    z-index: 7;
    max-width: 380px;
    margin: 0 auto;
    background: rgba(255,255,255,0.96);
    padding: 32px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    font-family: 'Dancing Script', cursive;
  }
  #revealArea.visible { display: block; }
  #revealArea.reveal-fade-in {
    transition: opacity 1s ease;
  }
  #cardsScreen.cards-fade-out #cardsContainer,
  #cardsScreen.cards-fade-out .continue-madness-btn {
    opacity: 0;
    transition: opacity 1s ease;
  }
  #cardsScreen.cards-fade-out {
    pointer-events: none;
  }
  #revealArea.summary-view {
    max-width: 540px;
    background-image: linear-gradient(rgba(255,255,255,0.75), rgba(255,255,255,0.7)), url('images/gf2.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  #revealArea .final-summary-wrap {
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    gap: 24px;
  }
  #revealArea .final-summary-content {
    flex: 1;
    min-width: 0;
  }
  #revealArea .final-summary-content h1 { color: #333; }
  #revealArea .final-summary-content h2 { color: #ff4d6d; }
  #revealArea .final-summary-valentine-img {
    display: block;
    width: 100%;
    max-width: 110px;
    height: auto;
    margin: 12px auto 16px;
    transform: translateX(-60px);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    object-fit: cover;
  }
  #revealArea .summary-winnings-row {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 16px;
    margin: 20px 0 0;
  }
  #revealArea .summary-winnings-left { flex: 1; min-width: 0; }
  #revealArea .summary-winnings-right {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #revealArea .final-summary-bear-gif {
    display: block;
    max-width: 100px;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    object-fit: contain;
  }
  #revealArea .winnings-list { text-align: left; margin: 0; padding-left: 24px; }
  #revealArea .winnings-list li { margin: 8px 0; color: #555; }
  #revealArea .last-page {
    margin-top: 32px;
    padding-top: 28px;
    border-top: 2px solid rgba(255, 77, 109, 0.35);
    text-align: center;
  }
  #revealArea .last-page .last-line {
    font-size: 1.35rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 8px;
    letter-spacing: 0.02em;
  }
  #revealArea .last-page .last-underline {
    display: block;
    width: 80px;
    height: 3px;
    margin: 0 auto;
    background: linear-gradient(90deg, transparent, #ff4d6d, transparent);
    border: none;
    border-radius: 2px;
  }
  /* ---------- Flower vase + falling petals (moonshine-style) ---------- */
  .last-page-vase {
    --vase-glass: linear-gradient(to left, #142544, #1a9092);
    --vase-water: linear-gradient(to left, #142544, #1b6d6e);
    position: relative;
    flex-shrink: 0;
    min-height: 200px;
    margin-top: 0;
    padding-top: 0;
    background: transparent;
    transform: translateX(-18px);
  }
  .last-page-vase .flower {
    position: relative;
    display: block;
    width: 20vmin;
    margin: 0 auto;
    min-height: 50vmin;
    overflow: visible;
  }
  .last-page-vase .flower__glass {
    width: 20vmin;
    height: 30vmin;
    background-image: var(--vase-glass);
    clip-path: polygon(0 0, 100% 0, 85% 100%, 15% 100%);
    opacity: 0.9;
    position: relative;
    margin: 0 auto;
    transform: translateY(20vmin);
  }
  .last-page-vase .flower__glass::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    background-color: #182843;
    width: 100%;
    height: 2vmin;
  }
  .last-page-vase .flower__glass::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    background-image: var(--vase-water);
    width: 100%;
    height: 15vmin;
  }
  .last-page-vase .f-wrapper {
    position: absolute;
    left: 45%;
    bottom: 2vmin;
  }
  .last-page-vase .f-wrapper--2 {
    left: 50%;
    bottom: 5%;
    transform-origin: 10% left;
    transform: rotate(20deg);
  }
  .last-page-vase .f-wrapper--3 {
    left: 30%;
    bottom: 5%;
    transform-origin: 10% left;
    transform: rotate(-10deg);
  }
  .last-page-vase .f-wrapper--3 .flower__line { height: 45vmin; position: relative; }
  .last-page-vase .f-wrapper--3 .flower__line::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 6vmin;
    height: 6vmin;
    transform: translate(-69%, -30%) rotate(-5deg);
    border-radius: 10vmin 10vmin 0 0;
    border: 2vmin solid #104d4e;
    border-bottom: transparent;
    border-left: transparent;
  }
  .last-page-vase .f-wrapper--3 .flower__line::before {
    content: '';
    position: absolute;
    left: -40%;
    top: -1%;
    width: 6vmin;
    height: 2vmin;
    transform-origin: right;
    transform: translate(-100%, -80%) rotate(-20deg);
    background-color: #104d4e;
    border-radius: 2vmin;
  }
  .last-page-vase .f-wrapper--3 .flower__line {
    background-image: linear-gradient(to top, #142544, #104d4e);
  }
  .last-page-vase .f-wrapper--2 .flower__line { height: 45vmin; }
  .last-page-vase .f-wrapper--2 .f { transform: translateX(-50%) rotate(20deg); }
  .last-page-vase .f-wrapper--3 .f { transform: translate(-350%, -50%) rotate(-120deg); }
  .last-page-vase .f-wrapper--2 .flower__leaf:not(:first-child) {
    width: 3.8vmin;
    height: 10vmin;
    background-image: linear-gradient(to bottom, #ff43b6, #c22887, #1a233a 99%);
  }
  .last-page-vase .f-wrapper--3 .flower__leaf:not(:first-child) {
    width: 3.8vmin;
    height: 10vmin;
    background-image: linear-gradient(to bottom, #ad2be0, #712291, #1a233a 99%);
  }
  .last-page-vase .f-wrapper--3 .flower__leaf--1 {
    width: 8vmin;
    height: 10vmin;
    bottom: 2vmin;
    background-color: #ad2be0;
  }
  .last-page-vase .f-wrapper--2 .flower__leaf--1 {
    width: 8vmin;
    height: 10vmin;
    bottom: 2vmin;
    background-color: #de118b;
  }
  .last-page-vase .f-wrapper--2 .f .flower__leaf--8 {
    width: 10vmin;
    height: 9vmin;
    bottom: 3vmin;
    left: -30%;
    transform: rotate(-50deg);
    background-image: linear-gradient(to left bottom, #ff43b6, #4d1337);
  }
  .last-page-vase .f-wrapper--3 .f .flower__leaf--8 {
    width: 10vmin;
    height: 9vmin;
    left: -10% !important;
    background-image: linear-gradient(to left bottom, #ad2be0, #712291);
  }
  .last-page-vase .flower__line {
    width: 2vmin;
    height: 56vmin;
    background-image: linear-gradient(to left top, #82fdff 20%, #142544, #104d4e);
    border-radius: 4vmin;
  }
  .last-page-vase .f {
    position: absolute;
    top: 1vmin;
    left: 50%;
    transform: translateX(-50%) rotate(-10deg);
    width: 2vmin;
    height: 2vmin;
  }
  .last-page-vase .flower__leaf {
    position: absolute;
    left: 50%;
    bottom: 2vmin;
    transform: translateX(-50%);
    width: 5vmin;
    height: 14vmin;
    background-image: linear-gradient(to bottom, #ffa085, #fa7373, #1a233a 99%);
    clip-path: ellipse(50% 50% at 50% 50%);
    transform-origin: center bottom;
    animation: vase-open-flower 2s 1s backwards;
  }
  .last-page-vase .flower__leaf--1 {
    width: 10vmin;
    height: 12vmin;
    bottom: 3vmin;
    border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
    background-color: #e24f5f;
    background-image: none;
    animation: vase-open-middle 1.4s 1s backwards;
  }
  .last-page-vase .flower__leaf--2 { transform: translateX(-50%) rotate(-30deg); }
  .last-page-vase .flower__leaf--3 { transform: translateX(-50%) rotate(-50deg); }
  .last-page-vase .flower__leaf--4 { transform: translateX(-50%) rotate(-70deg); }
  .last-page-vase .flower__leaf--5 { transform: translateX(-50%) rotate(30deg); }
  .last-page-vase .flower__leaf--6 { transform: translateX(-50%) rotate(50deg); }
  .last-page-vase .flower__leaf--7 { transform: translateX(-50%) rotate(70deg); }
  .last-page-vase .flower__leaf--8 {
    width: 13vmin;
    height: 11vmin;
    bottom: 6vmin;
    left: -30%;
    border-radius: 10vmin 2vmin 10vmin 2vmin;
    transform: rotate(-55deg);
    background-image: linear-gradient(to left bottom, #ffa085, #eb8b8b, #492f2f 98%);
    clip-path: none;
  }
  .last-page-vase .flower__fall-down--yellow {
    animation: vase-fall-yellow 8s 1.2s linear forwards;
  }
  .last-page-vase .flower__fall-down--pink {
    animation: vase-fall-pink 5s 1.2s linear forwards;
  }
  .last-page-vase .flower__fall-down--purple {
    bottom: 4vmin;
    animation: vase-fall-purple 6s 1.2s linear forwards, vase-fall-loop 6s 7.2s linear infinite;
  }
  @keyframes vase-open-flower {
    0% { transform: translateX(-50%) rotate(0); }
  }
  @keyframes vase-open-middle {
    0% { opacity: 0; transform: translateX(-50%) scale(0); }
  }
  @keyframes vase-fall-pink {
    0% { transform: rotate(-55deg); }
    50% { transform: rotateX(-100deg); }
    100% { transform: translate(2vmin, 28vmin); }
  }
  @keyframes vase-fall-yellow {
    0% { transform: rotate(-55deg); }
    50% { bottom: 3vmin; transform: rotateX(-100deg); }
    100% { transform: translate(2vmin, 70vmin) rotate(150deg); }
  }
  @keyframes vase-fall-purple {
    0% { transform: rotate(-50deg); }
    25% { bottom: 1vmin; transform: rotateX(-100deg); perspective: 0px; }
    50% { perspective: 0px; transform: translate(-30vmin, 2vmin) rotate(90deg); }
    75% { perspective: 0px; transform: translate(-34vmin, -2vmin); }
    100% { transform-origin: center; transform: translate(-34vmin, -2vmin) rotateY(-80deg) rotateX(35deg); }
  }
  @keyframes vase-fall-loop {
    0%, 100% { transform-origin: center; transform: translate(-34vmin, -2vmin) rotateY(-80deg) rotateX(35deg); }
    25% { transform-origin: center; transform: translate(-34.4vmin, -2vmin) rotateY(-84deg) rotateX(35deg); }
    50% { transform-origin: center; transform: translate(-32vmin, -4.2vmin) rotateY(-80deg) rotateX(35deg); }
    75% { transform-origin: center; transform: translate(-36vmin, 1.1vmin) rotateY(-80deg) rotateX(35deg); }
  }
  #revealArea .proposal-image-wrap {
    margin: 14px 0 18px;
    text-align: center;
    opacity: 0;
    transition: opacity 0.6s ease;
  }
  #revealArea .proposal-image-wrap.proposal-image-visible {
    opacity: 1;
  }
  #revealArea .proposal-shy-img {
    max-width: 140px;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    display: block;
    margin: 0 auto;
  }
  #revealArea .proposal-shy-img.proposal-img-spin {
    animation: proposalImgSpin 8s linear infinite;
  }
  @keyframes proposalImgSpin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  /* Proposal question typography */
  #revealArea #proposalQuestion {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    font-weight: 600;
    color: #333;
    margin: 0 0 12px;
  }
  #revealArea .buttons {
    position: relative;
    margin-top: 20px;
    height: 56px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
  }
  #revealArea .buttons.proposal-buttons-visible {
    opacity: 1;
    pointer-events: auto;
  }
  /* Congratulations / wait screen (image + message + continue) */
  #revealArea .congrats-screen-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 24px 20px 28px;
  }
  #revealArea .congrats-screen-wrap .congrats-img {
    width: 100%;
    max-width: 180px;
    height: auto;
    margin: 0 0 20px;
    display: block;
    object-fit: contain;
  }
  #revealArea .congrats-screen-wrap .congrats-message {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.35rem;
    color: #333;
    line-height: 1.6;
    margin: 0 0 28px;
    max-width: 320px;
  }
  #revealArea .congrats-screen-wrap .congrats-continue-btn {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    padding: 14px 32px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 16px rgba(255, 77, 109, 0.4);
    transition: background 0.2s, transform 0.15s;
  }
  #revealArea .congrats-screen-wrap .congrats-continue-btn:hover {
    background: #e84393;
    transform: scale(1.02);
  }
  /* Appreciation message screen (before proposal) */
  #revealArea .appreciation-screen-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 28px 24px 32px;
  }
  #revealArea .appreciation-screen-wrap .appreciation-message {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.25rem;
    color: #333;
    line-height: 1.7;
    margin: 0 0 28px;
    max-width: 360px;
  }
  #revealArea .appreciation-screen-wrap .appreciation-message p {
    margin: 0 0 1em;
  }
  #revealArea .appreciation-screen-wrap .appreciation-message p:last-of-type { margin-bottom: 0; }
  #revealArea .appreciation-screen-wrap .appreciation-continue-btn {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    padding: 14px 32px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 16px rgba(255, 77, 109, 0.4);
    transition: background 0.2s, transform 0.15s;
  }
  #revealArea .appreciation-screen-wrap .appreciation-continue-btn:hover {
    background: #e84393;
    transform: scale(1.02);
  }
  #revealArea .buttons button { font-family: 'Segoe UI', Tahoma, sans-serif; padding: 12px 24px; border-radius: 30px; border: none; font-size: 16px; cursor: pointer; }
  #revealArea #yesBtn { background: #ff4d6d; color: white; }
  #revealArea #noBtn { background: #f1f1f1; position: absolute; }
  .buttons-wrap { position: relative; margin-top: 20px; height: 56px; }

  /* ---------- Message screen (ValentineWish-style) ---------- */
  #messageScreen {
    position: relative;
    z-index: 5;
    width: 100%;
    max-width: 420px;
    margin: 0 auto;
    padding: 24px;
    text-align: center;
  }
  #messageScreen .message-card {
    background: linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.5)), url('images/Message.jpg') center / cover no-repeat;
    padding: 36px 28px;
    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.25);
    font-family: 'Playfair Display', serif;
  }
  #messageScreen .greeting {
    font-size: 2.1rem;
    color: #fff;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9), 0 3px 10px rgba(0,0,0,0.6);
    margin: 0 0 8px;
    opacity: 0;
    animation: msgFadeIn 0.6s ease forwards;
  }
  #messageScreen .subline {
    font-size: 1.2rem;
    font-weight: bold;
    color: rgba(255,255,255,0.95);
    text-shadow: 0 2px 4px rgba(0,0,0,0.9);
    margin: 0 0 24px;
    opacity: 0;
    animation: msgFadeIn 0.6s ease 0.2s forwards;
  }
  #messageScreen .message-body {
    text-align: left;
    margin: 20px 0 28px;
    line-height: 1.7;
    color: #fff;
    text-shadow: 0 1px 3px rgba(0,0,0,0.8), 0 2px 6px rgba(0,0,0,0.6);
    font-family: 'Cormorant Garamond', serif;
    font-weight: 600;
  }
  #messageScreen .message-body p {
    margin: 0 0 14px;
  }
  #messageScreen .message-body .msg-char,
  #messageScreen .special .msg-char {
    display: inline;
    opacity: 0;
    animation: msgCharIn 0.35s ease-out forwards;
    white-space: pre;
  }
  #messageScreen .special {
    font-size: 1.65rem;
    font-weight: 700;
    color: #ffd1dc;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9), 0 3px 8px rgba(0,0,0,0.6);
    margin: 16px 0 24px;
    font-family: 'Cormorant Garamond', serif;
  }
  #messageScreen .special .msg-char { animation: msgCharIn 0.35s ease-out forwards; }
  @keyframes msgCharIn {
    from { opacity: 0; transform: translateY(2px); }
    to { opacity: 1; transform: translateY(0); }
  }
  /* Typewriter blinking cursor at end of message */
  .typewriter-cursor {
    display: inline-block;
    opacity: 0;
    font-weight: 400;
    margin-left: 1px;
  }
  .typewriter-cursor.revealed {
    animation: typewriterBlink 0.7s step-end infinite;
  }
  @keyframes typewriterBlink {
    0%, 49% { opacity: 1; }
    50%, 100% { opacity: 0; }
  }
  #messageScreen .msg-cta {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
    padding: 14px 32px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: #ff4d6d;
    color: white;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s;
    opacity: 0;
    animation: msgFadeIn 0.5s ease forwards;
  }
  #messageScreen .msg-cta:hover { background: #e84393; transform: scale(1.02); }

  /* ---------- Emoji rush from bottom (ValentineWish-style) ---------- */
  #emojiRushScreen {
    position: fixed;
    inset: 0;
    z-index: 6;
    overflow: hidden;
    pointer-events: none;
    display: none;
  }
  #emojiRushScreen.visible {
    display: block;
  }
  #emojiRushContainer {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 100%;
    pointer-events: none;
  }
  .emoji-rush-item {
    position: absolute;
    bottom: -0.3em;
    font-size: 4rem;
    line-height: 1;
    opacity: 0;
    animation: emojiRushUp 4.4s ease-out forwards;
    text-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transform: translateX(-50%);
    --start-y: 0vh;
  }
  @keyframes emojiRushUp {
    0% {
      transform: translateX(-50%) translateY(var(--start-y)) scale(0.5);
      opacity: 0.85;
    }
    15% {
      opacity: 0.95;
    }
    100% {
      transform: translateX(-50%) translateY(-130vh) scale(1.1);
      opacity: 0.25;
    }
  }

  @keyframes msgFadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div id="floatBg" aria-hidden="true"></div>
<canvas id="canvas"></canvas>

<div id="messageScreen" class="screen">
  <div class="message-card">
    <h1 class="greeting" id="msgGreeting">This is for you</h1>
    <p class="subline" id="msgSubline"></p>
    <div class="message-body" id="msgBody">
      <p>Before Valentine's Day arrives,</p>
      <p>I wanted to pause for a moment.</p>
      <p></p>
      <p>To remind you</p>
      <p>that you are loved in the quiet moments,</p>
      <p>not just on special dates.</p>
      <p></p>
      <p>I may not always say everything perfectly,</p>
      <p>but I feel it deeply.</p>
      <p></p>
      <p>So I made something small for you‚Äî</p>
      <p>a few surprises,</p>
      <p>and something I've been wanting to ask.</p>
    </div>
    <p class="special" id="msgSpecial">You are special to me üíó</p>
    <button type="button" class="msg-cta" id="msgCtaBtn">See what's inside</button>
  </div>
</div>

<div id="emojiRushScreen">
  <div id="emojiRushContainer"></div>
</div>

<div id="startScreen" class="screen hidden">
  <img src="images/Surprise.gif" alt="" class="start-surprise-gif" id="startSurpriseGif">
  <h1>Hey you!</h1>
  <p>I have a few surprises for you. Ready?</p>
  <button type="button" class="start-btn" id="startBtn">I'm ready</button>
</div>

<div id="cardsScreen" class="screen hidden">
  <div id="cardsContainer" class="jackpot-cards"></div>
  <button type="button" id="continueMadnessBtn" class="continue-madness-btn hidden">Congratulations</button>
</div>

<div id="revealArea">
  <div id="revealContent"></div>
</div>

<script>
/* ---------- Canvas ---------- */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.onresize = function() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
};

/* ---------- Fireworks ---------- */
var rockets = [], particles = [], confetti = [];
var gravity = 0.06, MAX_PARTICLES = 400, MAX_ROCKETS_IN_FLIGHT = 4, rocketQueue = 0;
var fireworkColors = ['#ff4d6d', '#ff6b9d', '#ff9a9e', '#ffd93d', '#e84393', '#fd79a8', '#fdcb6e', '#ffffff'];
var confettiColors = ['#ff4d6d', '#ff6b9d', '#ffd93d', '#e84393', '#fd79a8', '#fff5e6', '#ffffff', '#ff9a9e'];

function createRocket() {
  if (rockets.length >= MAX_ROCKETS_IN_FLIGHT) { rocketQueue++; return; }
  var x = Math.random() * canvas.width * 0.6 + canvas.width * 0.2;
  rockets.push({ x: x, y: canvas.height, vx: (Math.random() - 0.5) * 2, vy: -Math.random() * 4 - 10, color: fireworkColors[Math.floor(Math.random() * fireworkColors.length)], trail: [] });
}
function explodeRocket(r) {
  if (particles.length >= MAX_PARTICLES) return;
  for (var i = 0; i < 35; i++) {
    var angle = Math.random() * Math.PI * 2, speed = Math.random() * 4 + 3;
    particles.push({ x: r.x, y: r.y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, radius: 1.5, life: 60 + Math.random() * 40, maxLife: 100, color: fireworkColors[Math.floor(Math.random() * fireworkColors.length)] });
  }
  for (var i = 0; i < 15; i++) {
    var angle = Math.random() * Math.PI * 2, speed = Math.random() * 6 + 4;
    particles.push({ x: r.x, y: r.y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, radius: 1, life: 40 + Math.random() * 30, maxLife: 70, color: '#ffffff' });
  }
}
function burstPartyPopper(cx, cy) {
  for (var i = 0; i < 60; i++) {
    var angle = Math.random() * Math.PI * 2, speed = Math.random() * 8 + 6;
    confetti.push({ x: cx, y: cy, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed - 2, w: 4 + Math.random() * 6, h: 2 + Math.random() * 4, color: confettiColors[Math.floor(Math.random() * confettiColors.length)], rot: Math.random() * 360, rotSpeed: (Math.random() - 0.5) * 20, life: 120 + Math.random() * 60, maxLife: 180 });
  }
}
function tick() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (rocketQueue > 0 && rockets.length < MAX_ROCKETS_IN_FLIGHT) { rocketQueue--; createRocket(); }
  for (var i = rockets.length - 1; i >= 0; i--) {
    var r = rockets[i];
    r.trail.push({ x: r.x, y: r.y }); if (r.trail.length > 8) r.trail.shift();
    r.x += r.vx; r.y += r.vy; r.vy += 0.12;
    ctx.strokeStyle = r.color; ctx.lineWidth = 2; ctx.beginPath();
    r.trail.forEach(function(t, j) { if (j === 0) ctx.moveTo(t.x, t.y); else ctx.lineTo(t.x, t.y); });
    ctx.globalAlpha = 0.6; ctx.stroke(); ctx.globalAlpha = 1;
    ctx.fillStyle = r.color; ctx.beginPath(); ctx.arc(r.x, r.y, 2.5, 0, Math.PI * 2); ctx.fill();
    if (r.vy >= 0) { explodeRocket(r); rockets.splice(i, 1); }
  }
  for (var i = particles.length - 1; i >= 0; i--) {
    var p = particles[i];
    p.x += p.vx; p.y += p.vy; p.vy += gravity; p.vx *= 0.98; p.vy *= 0.98; p.life--;
    var alpha = p.life / p.maxLife, rad = Math.max(0.3, p.radius * alpha);
    ctx.globalAlpha = alpha; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, rad, 0, Math.PI * 2); ctx.fill(); ctx.globalAlpha = 1;
    if (p.life <= 0) particles.splice(i, 1);
  }
  for (var i = confetti.length - 1; i >= 0; i--) {
    var c = confetti[i];
    c.x += c.vx; c.y += c.vy; c.vy += 0.08; c.vx *= 0.99; c.vy *= 0.99; c.rot += c.rotSpeed; c.life--;
    var alpha = c.life / c.maxLife;
    ctx.save(); ctx.translate(c.x, c.y); ctx.rotate(c.rot * Math.PI / 180); ctx.globalAlpha = alpha; ctx.fillStyle = c.color; ctx.fillRect(-c.w / 2, -c.h / 2, c.w, c.h); ctx.restore();
    if (c.life <= 0) confetti.splice(i, 1);
  }
  requestAnimationFrame(tick);
}
tick();

/* ---------- Music ---------- */
var audio = new Audio();
audio.loop = true; audio.volume = 0.7; audio.preload = 'auto';
var musicUrls = ['music/music1.mp3', 'https://cdn.pixabay.com/audio/2022/08/04/audio_381a7f2d2c.mp3', 'https://cdn.pixabay.com/audio/2022/05/27/audio_306c755a2f.mp3'];
var audioCtx = null, fallbackPlaying = false;
function playFallbackMusic() {
  if (fallbackPlaying) return;
  fallbackPlaying = true;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  var notes = [261.63, 293.66, 329.63, 349.23, 392, 440, 493.88, 523.25], melody = [0, 2, 4, 2, 0, 4, 5, 4, 2, 4, 2, 0, 0, 2, 2, 4, 4, 5, 4, 2, 0], i = 0;
  function playNote() {
    if (i >= melody.length) i = 0;
    var osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
    osc.type = 'sine'; osc.frequency.value = notes[melody[i]];
    gain.gain.setValueAtTime(0.12, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
    osc.connect(gain); gain.connect(audioCtx.destination); osc.start(audioCtx.currentTime); osc.stop(audioCtx.currentTime + 0.45);
    i++; if (fallbackPlaying) setTimeout(playNote, 380);
  }
  playNote();
}
function playMusic() {
  audio.currentTime = 0;
  function tryUrl(idx) {
    if (idx >= musicUrls.length) { playFallbackMusic(); return; }
    audio.src = musicUrls[idx]; audio.load();
    audio.play().then(function() {}).catch(function() { tryUrl(idx + 1); });
  }
  tryUrl(0);
}
function playCongratulations() {
  audio.pause();
  var congrats = new Audio('music/congratulations.mp3');
  congrats.loop = true;
  congrats.volume = 0.8;
  congrats.play().then(function() {}).catch(function() {});
}

/* ---------- Message screen config (edit this to personalize) ---------- */
var MESSAGE_CONFIG = {
  name: 'you',
  greeting: "This is for you",
  subline: "",
  messageLines: [
    "Before Valentine's Day arrives,",
    "I wanted to pause for a moment.",
    "",
    "To remind you",
    "that you are loved in the quiet moments,",
    "not just on special dates.",
    "",
    "I may not always say everything perfectly,",
    "but I feel it deeply.",
    "",
    "So I made something small for you‚Äî",
    "a few surprises,",
    "and something I've been wanting to ask.",
  ],
  specialLine: "You are special to me üíó",
  ctaText: "See what's inside",
  lastPageLine: "Thank you for being my girlfriend",
  proposalImage: "images/proposal-shy.png",
  gfImage: "images/gf.jpg"
};

/* ---------- Jackpot flow ---------- */
var PRIZES = ['Flower', 'Sweet', 'Soft toy', 'Date night'];
var PRIZE_IMAGES = ['images/flower.jpg', 'images/Sweet.jpg', 'images/soft_toys.jpg', 'images/Date_night.jpg'];
var CARD_QUIZZES = [
  { question: "What do I love giving you most?", options: ["Flowers", "Chocolates", "Socks"], correctIndex: 0 },
  { question: "What sweet thing do we share?", options: ["Dessert", "Sweet moments", "Nothing"], correctIndex: 1 },
  { question: "What cuddly gift fits you?", options: ["A book", "A soft toy", "A plant"], correctIndex: 1 },
  { question: "What's the best way to spend time together?", options: ["Date night", "Texting", "Sleeping alone"], correctIndex: 0 }
];
var prizeIndex = 0;
var revealing = false;
var messageScreen = document.getElementById('messageScreen');
var emojiRushScreen = document.getElementById('emojiRushScreen');
var emojiRushContainer = document.getElementById('emojiRushContainer');
var startScreen = document.getElementById('startScreen');
var cardsScreen = document.getElementById('cardsScreen');
var cardsContainer = document.getElementById('cardsContainer');
var revealArea = document.getElementById('revealArea');
var revealContent = document.getElementById('revealContent');

(function initMessageScreen() {
  if (!messageScreen) return;
  var g = document.getElementById('msgGreeting');
  var s = document.getElementById('msgSubline');
  var b = document.getElementById('msgBody');
  var sp = document.getElementById('msgSpecial');
  var btn = document.getElementById('msgCtaBtn');
  if (g) g.textContent = MESSAGE_CONFIG.greeting;
  if (s) s.textContent = MESSAGE_CONFIG.subline;

  var letterDelaySec = 0.035;
  var startDelay = 0.5;
  var charIndex = 0;

  function escapeChar(ch) {
    return ch.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  function wrapLettersInSpans(text) {
    var html = '';
    for (var i = 0; i < text.length; i++) {
      var ch = text[i];
      var delay = startDelay + charIndex * letterDelaySec;
      charIndex++;
      html += '<span class="msg-char" style="animation-delay:' + delay + 's">' + escapeChar(ch) + '</span>';
    }
    return html;
  }

  if (b && MESSAGE_CONFIG.messageLines && MESSAGE_CONFIG.messageLines.length) {
    b.innerHTML = MESSAGE_CONFIG.messageLines.map(function(line) {
      return '<p>' + wrapLettersInSpans(line) + '</p>';
    }).join('');
  }

  if (sp && MESSAGE_CONFIG.specialLine) {
    var cursorDelay = startDelay + (charIndex - 1) * letterDelaySec + 0.35;
    sp.innerHTML = wrapLettersInSpans(MESSAGE_CONFIG.specialLine) +
      '<span class="typewriter-cursor" id="msgTypewriterCursor">|</span>';
    var cursorEl = document.getElementById('msgTypewriterCursor');
    if (cursorEl) {
      setTimeout(function() {
        cursorEl.style.opacity = '1';
        cursorEl.classList.add('revealed');
      }, cursorDelay * 1000);
    }
  }

  var ctaDelay = startDelay + charIndex * letterDelaySec + 0.35;
  if (btn) {
    btn.textContent = MESSAGE_CONFIG.ctaText;
    btn.style.animationDelay = ctaDelay + 's';
    btn.addEventListener('click', function() {
      messageScreen.classList.add('hidden');
      showEmojiRushThenStart();
    });
  }
})();

var EMOJI_RUSH_SYMBOLS = ['‚ù§Ô∏è', 'üíï', 'üåπ', 'üéÅ', 'üíñ', 'üéà', 'üíó', 'üå∏', 'üíù', 'üå∑', 'ü´∂', 'üíì', 'üå∫', '‚ú®', 'üíû'];
function showEmojiRushThenStart() {
  playMusic();
  if (!emojiRushScreen || !emojiRushContainer) {
    startScreen.classList.remove('hidden');
    return;
  }
  emojiRushContainer.innerHTML = '';
  var count = 56;
  var minSize = 3;
  var maxSize = 6;
  var visibilityMs = 5600;
  var animationDurationMs = 4400;
  var maxDelaySec = (visibilityMs - animationDurationMs) / 1000;
  var cols = 10;
  var rows = Math.ceil(count / cols);
  var startYStep = 22;
  for (var i = 0; i < count; i++) {
    var col = i % cols;
    var row = Math.floor(i / cols);
    var cellW = 100 / cols;
    var jitter = (Math.random() - 0.5) * cellW * 0.4;
    var leftPct = (col + 0.5) * cellW + jitter;
    var startY = row * startYStep;
    var el = document.createElement('span');
    el.className = 'emoji-rush-item';
    el.textContent = EMOJI_RUSH_SYMBOLS[Math.floor(Math.random() * EMOJI_RUSH_SYMBOLS.length)];
    el.style.left = leftPct + '%';
    el.style.setProperty('--start-y', startY + 'vh');
    el.style.fontSize = (minSize + Math.random() * (maxSize - minSize)).toFixed(1) + 'rem';
    el.style.animationDelay = (count > 1 ? (i / (count - 1)) * maxDelaySec : 0) + 's';
    emojiRushContainer.appendChild(el);
  }
  emojiRushScreen.classList.add('visible');
  setTimeout(function() {
    emojiRushScreen.classList.remove('visible');
    startScreen.classList.remove('hidden');
  }, 5600);
}

var FLOAT_TYPES = [{ sym: '‚ù§Ô∏è', name: 'heart' }, { sym: 'üåπ', name: 'rose' }, { sym: 'üß∏', name: 'teddy' }];
var FLOATS_PER_TYPE = 8;
(function initFloatingBg() {
  var container = document.getElementById('floatBg');
  if (!container) return;
  var basePositions = [
    [8, 15], [8, 35], [8, 55], [8, 75],
    [22, 22], [22, 42], [22, 62], [22, 82],
    [36, 18], [36, 38], [36, 58], [36, 78]
  ];
  var positions = [];
  basePositions.forEach(function(p) {
    positions.push({ left: p[0] + '%', top: p[1] + '%' });
    positions.push({ left: (100 - p[0]) + '%', top: p[1] + '%' });
  });
  var symbols = [];
  FLOAT_TYPES.forEach(function(t) {
    for (var i = 0; i < FLOATS_PER_TYPE; i++) symbols.push(t.sym);
  });
  for (var i = symbols.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var s = symbols[i]; symbols[i] = symbols[j]; symbols[j] = s;
  }
  var sizeBase = 56;
  for (var i = 0; i < positions.length; i++) {
    var el = document.createElement('span');
    el.className = 'float-item';
    el.textContent = symbols[i];
    el.style.left = positions[i].left;
    el.style.top = positions[i].top;
    el.style.fontSize = sizeBase + 'px';
    el.style.animationDelay = (Math.random() * -20) + 's';
    el.style.opacity = (0.12 + Math.random() * 0.12).toFixed(2);
    container.appendChild(el);
  }
})();

var CARD_EMOJIS = ['‚ù§Ô∏è', 'üíï', 'üåπ', 'üéÅ', 'üíñ'];
function shuffleArray(arr) {
  for (var i = arr.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var t = arr[i]; arr[i] = arr[j]; arr[j] = t;
  }
  return arr;
}

function buildQuizHtml(quiz) {
  var options = quiz.options.map(function(text, i) { return { text: text, isCorrect: i === quiz.correctIndex }; });
  shuffleArray(options);
  var newCorrectIndex = -1;
  options.forEach(function(o, i) { if (o.isCorrect) newCorrectIndex = i; });
  var optsHtml = options.map(function(o, i) {
    return '<li class="quiz-option" data-option-index="' + i + '" role="button" tabindex="0">' + o.text.replace(/</g, '&lt;').replace(/&/g, '&amp;') + '</li>';
  }).join('');
  return { html: '<div class="card-quiz"><p class="quiz-question">' + quiz.question.replace(/</g, '&lt;').replace(/&/g, '&amp;') + '</p><ul class="quiz-options">' + optsHtml + '</ul></div>', correctIndex: newCorrectIndex };
}

function showSurpriseOnCard(card, idx) {
  var front = card.querySelector('.card-front');
  if (idx < PRIZE_IMAGES.length) front.style.backgroundImage = 'url(' + PRIZE_IMAGES[idx] + ')';
  front.innerHTML = '<div class="card-front-inner"><h2>Hurray!</h2><p>You won: ' + PRIZES[idx] + '</p></div>';
  card.dataset.revealed = 'true';
  revealing = false;
  burstPartyPopper(canvas.width / 2, canvas.height / 2);
  setTimeout(function() { burstPartyPopper(canvas.width / 2 - 30, canvas.height / 2 - 20); }, 120);
  var cards = cardsContainer.querySelectorAll('.jackpot-card');
  var allRevealed = cards.length === 4 && Array.prototype.every.call(cards, function(c) { return c.dataset.revealed === 'true'; });
  if (allRevealed) allRevealedSequence();
}

function renderCards() {
  var order = [0, 1, 2, 3];
  shuffleArray(order);
  cardsContainer.innerHTML = '';
  cardsContainer.classList.remove('cards-forming-one');
  cardsContainer.style.minHeight = '';
  cardsContainer.style.minWidth = '';
  var continueBtn = document.getElementById('continueMadnessBtn');
  if (continueBtn) continueBtn.classList.add('hidden');
  for (var i = 0; i < 4; i++) {
    var emoji = CARD_EMOJIS[Math.floor(Math.random() * CARD_EMOJIS.length)];
    var card = document.createElement('div');
    card.className = 'jackpot-card';
    card.dataset.prizeIndex = order[i];
    card.innerHTML = '<div class="card-inner"><div class="card-back">' + emoji + '</div><div class="card-front"></div></div>';
    cardsContainer.appendChild(card);
  }
}

function showStartScreen() {
  startScreen.classList.remove('hidden');
  cardsScreen.classList.add('hidden');
  revealArea.classList.remove('visible', 'summary-view');
}

function showCardsScreen() {
  startScreen.classList.add('hidden');
  cardsScreen.classList.remove('hidden');
  revealArea.classList.remove('visible', 'summary-view');
  renderCards();
}

function showReveal(html) {
  cardsScreen.classList.add('hidden');
  revealContent.innerHTML = html;
  revealArea.classList.remove('summary-view');
  revealArea.classList.add('visible');
}

function onContinue() {
  showCardsScreen();
}

var PROPOSAL_QUESTION_TEXT = 'Will you be my Valentine? üëâüëà';

function getProposalHTML() {
  var imgHtml = '';
  if (MESSAGE_CONFIG.proposalImage) {
    imgHtml = '<div class="proposal-image-wrap"><img src="' + MESSAGE_CONFIG.proposalImage.replace(/"/g, '&quot;') + '" alt="" class="proposal-shy-img" onerror="this.parentElement.style.display=\'none\'"></div>';
  }
  return '<h1>Hey You ‚ù§Ô∏è</h1><p>I was wondering something‚Ä¶</p><h2 id="proposalQuestion"><span id="proposalQuestionText"></span></h2>' + imgHtml + '<div class="buttons proposal-buttons-hidden"><button type="button" id="yesBtn">Yes üíñ</button><button type="button" id="noBtn">No üôÉ</button></div>';
}

function runProposalSequence() {
  var questionEl = document.getElementById('proposalQuestionText');
  var imageWrap = revealContent.querySelector('.proposal-image-wrap');
  var imgEl = imageWrap ? imageWrap.querySelector('.proposal-shy-img') : null;
  var buttonsEl = revealContent.querySelector('.buttons');
  if (!questionEl) return;
  var text = PROPOSAL_QUESTION_TEXT;
  var delayMs = 95;
  var i = 0;
  function escapeChar(ch) {
    return ch.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }
  function typeNext() {
    if (i >= text.length) {
      if (imageWrap) {
        imageWrap.classList.add('proposal-image-visible');
        if (imgEl) imgEl.classList.add('proposal-img-spin');
      }
      setTimeout(function() {
        if (buttonsEl) buttonsEl.classList.add('proposal-buttons-visible');
        if (buttonsEl) buttonsEl.classList.remove('proposal-buttons-hidden');
      }, 1800);
      return;
    }
    questionEl.innerHTML += escapeChar(text[i]);
    i++;
    setTimeout(typeNext, delayMs);
  }
  setTimeout(typeNext, 400);
}

function attachProposalListeners() {
  var noBtn = document.getElementById('noBtn');
  var yesBtn = document.getElementById('yesBtn');
  if (!noBtn || !yesBtn) return;
  noBtn.addEventListener('mouseover', function() {
    noBtn.style.transform = 'translate(' + (Math.random() * 200 - 100) + 'px, ' + (Math.random() * 200 - 100) + 'px)';
  });
  yesBtn.addEventListener('click', function() {
    document.body.classList.add('celebrate');
    playCongratulations();
    var cx = canvas.width / 2, cy = canvas.height / 2;
    burstPartyPopper(cx, cy);
    setTimeout(function() { burstPartyPopper(cx - 40, cy - 20); }, 150);
    setTimeout(function() { burstPartyPopper(cx + 30, cy - 10); }, 300);
    for (var i = 0; i < 45; i++) { setTimeout(function() { createRocket(); }, i * 600); }
    setTimeout(function() {
      cardsScreen.classList.add('hidden');
      var vaseHtml = '<div class="last-page-vase"><div class="flower">';
      vaseHtml += '<div class="f-wrapper"><div class="flower__line"></div><div class="f"><div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div><div class="flower__leaf flower__leaf--5"></div><div class="flower__leaf flower__leaf--6"></div><div class="flower__leaf flower__leaf--7"></div><div class="flower__leaf flower__leaf--8 flower__fall-down--yellow"></div></div></div>';
      vaseHtml += '<div class="f-wrapper f-wrapper--2"><div class="flower__line"></div><div class="f"><div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div><div class="flower__leaf flower__leaf--5"></div><div class="flower__leaf flower__leaf--6"></div><div class="flower__leaf flower__leaf--7"></div><div class="flower__leaf flower__leaf--8 flower__fall-down--pink"></div></div></div>';
      vaseHtml += '<div class="f-wrapper f-wrapper--3"><div class="flower__line"></div><div class="f"><div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div><div class="flower__leaf flower__leaf--5"></div><div class="flower__leaf flower__leaf--6"></div><div class="flower__leaf flower__leaf--7"></div><div class="flower__leaf flower__leaf--8 flower__fall-down--purple"></div></div></div>';
      vaseHtml += '<div class="flower__glass"></div></div></div>';
      var lastLine = (MESSAGE_CONFIG.lastPageLine != null) ? MESSAGE_CONFIG.lastPageLine : 'Thank you for being my girlfriend';
      var contentHtml = '<div class="final-summary-content"><h1>It\'s a YES!</h1><img src="images/Hehe.gif" alt="" class="final-summary-valentine-img" onerror="this.style.display=\'none\'"><div class="summary-winnings-row"><div class="summary-winnings-left"><h2>Your winnings</h2><ul class="winnings-list">';
      PRIZES.forEach(function(p) { contentHtml += '<li>' + p + '</li>'; });
      contentHtml += '</ul></div><div class="summary-winnings-right"><img src="https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif" alt="" class="final-summary-bear-gif" onerror="this.style.display=\'none\'"></div></div><div class="last-page"><p class="last-line">' + lastLine.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p><span class="last-underline"></span></div></div>';
      revealContent.innerHTML = '<div class="final-summary-wrap">' + vaseHtml + contentHtml + '</div>';
      revealArea.classList.add('visible', 'summary-view');
    }, 800);
  });
}

function getCongratulationsScreenHTML() {
  var msg = "You found all the surprises! There's one more thing I've been wanting to ask you‚Ä¶";
  return '<div class="congrats-screen-wrap">' +
    '<img src="images/wait.png" alt="" class="congrats-img">' +
    '<p class="congrats-message">' + msg.replace(/</g, '&lt;').replace(/&/g, '&amp;') + '</p>' +
    '<button type="button" class="congrats-continue-btn" id="congratsContinueBtn">Continue</button>' +
    '</div>';
}

function escapeHtml(s) {
  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

function getAppreciationScreenHTML() {
  var lines = [
    "Before anything else‚Ä¶",
    "I just want you to know how much I appreciate having you in my life.",
    "The way you think, the way you feel things deeply, the way you understand people ‚Äî including me.",
    "So here's the question I've been holding onto."
  ];
  var html = '<div class="appreciation-screen-wrap"><div class="appreciation-message">';
  lines.forEach(function(line) {
    html += '<p>' + escapeHtml(line) + '</p>';
  });
  html += '</div><button type="button" class="appreciation-continue-btn" id="appreciationContinueBtn">Continue</button></div>';
  return html;
}

function showCongratulationsMessage() {
  cardsScreen.classList.add('cards-fade-out');
  var fadeDuration = 1000;
  setTimeout(function() {
    cardsScreen.classList.remove('cards-fade-out');
    cardsScreen.classList.add('hidden');
    revealContent.innerHTML = getCongratulationsScreenHTML();
    revealArea.classList.remove('summary-view', 'reveal-fade-in');
    revealArea.classList.add('visible');
    revealArea.style.opacity = '0';
    revealArea.classList.add('reveal-fade-in');
    requestAnimationFrame(function() {
      requestAnimationFrame(function() {
        revealArea.style.opacity = '1';
      });
    });
    setTimeout(function() { revealArea.style.opacity = ''; }, fadeDuration);
    var continueBtn = document.getElementById('congratsContinueBtn');
    if (continueBtn) continueBtn.addEventListener('click', function() { showAppreciationMessage(); }, { once: true });
  }, fadeDuration);
}

function showAppreciationMessage() {
  revealContent.innerHTML = getAppreciationScreenHTML();
  revealArea.classList.remove('summary-view', 'reveal-fade-in');
  revealArea.classList.add('visible');
  revealArea.style.opacity = '0';
  revealArea.classList.add('reveal-fade-in');
  requestAnimationFrame(function() {
    requestAnimationFrame(function() {
      revealArea.style.opacity = '1';
    });
  });
  setTimeout(function() { revealArea.style.opacity = ''; }, 1000);
  var continueBtn = document.getElementById('appreciationContinueBtn');
  if (continueBtn) continueBtn.addEventListener('click', function() { showProposalScreen(); }, { once: true });
}

function showProposalScreen() {
  cardsScreen.classList.add('cards-fade-out');
  var fadeDuration = 1000;
  setTimeout(function() {
    cardsScreen.classList.remove('cards-fade-out');
    cardsScreen.classList.add('hidden');
    revealContent.innerHTML = getProposalHTML();
    revealArea.classList.remove('summary-view', 'reveal-fade-in');
    revealArea.classList.add('visible');
    revealArea.style.opacity = '0';
    revealArea.classList.add('reveal-fade-in');
    requestAnimationFrame(function() {
      requestAnimationFrame(function() {
        revealArea.style.opacity = '1';
      });
    });
    setTimeout(function() {
      revealArea.style.opacity = '';
    }, fadeDuration);
    attachProposalListeners();
    runProposalSequence();
  }, fadeDuration);
}

function allRevealedSequence() {
  var cx = canvas.width / 2, cy = canvas.height / 2;
  burstPartyPopper(cx, cy);
  setTimeout(function() { burstPartyPopper(cx - 50, cy - 30); }, 100);
  setTimeout(function() { burstPartyPopper(cx + 40, cy - 20); }, 200);
  setTimeout(function() { burstPartyPopper(cx - 20, cy + 30); }, 300);
  setTimeout(function() { burstPartyPopper(cx + 50, cy + 10); }, 400);
  for (var i = 0; i < 35; i++) {
    (function(j) { setTimeout(function() { createRocket(); }, j * 550); })(i);
  }
  var cards = cardsContainer.querySelectorAll('.jackpot-card');
  var gfImg = (MESSAGE_CONFIG && MESSAGE_CONFIG.gfImage) ? MESSAGE_CONFIG.gfImage : 'images/gf.jpg';
  setTimeout(function() {
    cards.forEach(function(c, i) {
      var front = c.querySelector('.card-front');
      if (!front) return;
      front.style.backgroundImage = 'url(' + gfImg + ')';
      front.classList.add('gf-quadrant', 'q' + i);
      front.innerHTML = '';
    });
    cardsContainer.offsetHeight;
    cardsContainer.classList.add('flip-slow');
    cards.forEach(function(c) { c.classList.remove('flipped'); });
    var firstInner = cards[0].querySelector('.card-inner');
    firstInner.addEventListener('transitionend', function onFlipBack() {
      firstInner.removeEventListener('transitionend', onFlipBack);
      cards.forEach(function(c) { c.classList.add('flipped'); });
      var firstInner2 = cards[0].querySelector('.card-inner');
      firstInner2.addEventListener('transitionend', function onFlipFront() {
        firstInner2.removeEventListener('transitionend', onFlipFront);
        cardsContainer.classList.remove('flip-slow');
        var continueBtn = document.getElementById('continueMadnessBtn');
        if (continueBtn) {
          continueBtn.textContent = 'Congratulations';
          continueBtn.classList.remove('hidden');
        }
        formOneBigCard(cards);
      }, { once: true });
    }, { once: true });
  }, 1200);
}

function formOneBigCard(cards) {
  if (!cards || cards.length !== 4) return;
  var containerRect = cardsContainer.getBoundingClientRect();
  var cardRects = [];
  for (var i = 0; i < 4; i++) cardRects.push(cards[i].getBoundingClientRect());
  cardsContainer.style.minHeight = containerRect.height + 'px';
  cardsContainer.style.minWidth = containerRect.width + 'px';
  cardsContainer.classList.add('cards-forming-one');
  var bigW = cardRects[0].width * 2;
  var bigH = cardRects[0].height * 2;
  var bigLeft = (containerRect.width - bigW) / 2;
  var bigTop = (containerRect.height - bigH) / 2;
  var positions = [
    { left: bigLeft, top: bigTop },
    { left: bigLeft + cardRects[0].width, top: bigTop },
    { left: bigLeft, top: bigTop + cardRects[0].height },
    { left: bigLeft + cardRects[0].width, top: bigTop + cardRects[0].height }
  ];
  for (var i = 0; i < 4; i++) {
    var c = cards[i];
    var r = cardRects[i];
    c.style.left = (r.left - containerRect.left) + 'px';
    c.style.top = (r.top - containerRect.top) + 'px';
    c.style.width = r.width + 'px';
    c.style.height = r.height + 'px';
    c.style.maxWidth = 'none';
    c.style.maxHeight = 'none';
    c.style.aspectRatio = 'auto';
  }
  requestAnimationFrame(function() {
    requestAnimationFrame(function() {
      for (var i = 0; i < 4; i++) {
        var c = cards[i];
        var p = positions[i];
        c.style.left = p.left + 'px';
        c.style.top = p.top + 'px';
        c.style.width = (bigW / 2) + 'px';
        c.style.height = (bigH / 2) + 'px';
      }
    });
  });
}

function onCardClick(e) {
  var card = e.target.closest('.jackpot-card');
  if (!card) return;
  var optionEl = e.target.closest('.quiz-option');
  if (optionEl) {
    if (optionEl.classList.contains('wrong')) return;
    var idx = parseInt(card.dataset.prizeIndex, 10);
    var correctOpt = parseInt(card.dataset.correctOption, 10);
    var clickedOpt = parseInt(optionEl.dataset.optionIndex, 10);
    if (clickedOpt === correctOpt) {
      showSurpriseOnCard(card, idx);
    } else {
      card.classList.add('shake');
      optionEl.classList.add('wrong');
      var onShakeEnd = function() {
        card.classList.remove('shake');
        card.removeEventListener('animationend', onShakeEnd);
      };
      card.addEventListener('animationend', onShakeEnd);
    }
    return;
  }
  if (revealing || card.classList.contains('flipped')) return;
  var idx = parseInt(card.dataset.prizeIndex, 10);
  if (isNaN(idx) || idx < 0 || idx >= PRIZES.length) return;
  revealing = true;
  card.classList.add('flipped');
  var front = card.querySelector('.card-front');
  var inner = card.querySelector('.card-inner');
  inner.addEventListener('transitionend', function once() {
    inner.removeEventListener('transitionend', once);
    var quiz = CARD_QUIZZES[idx];
    if (!quiz) {
      showSurpriseOnCard(card, idx);
      return;
    }
    var shuffled = buildQuizHtml(quiz);
    front.innerHTML = shuffled.html;
    card.dataset.correctOption = shuffled.correctIndex;
  }, { once: true });
}

document.getElementById('startBtn').addEventListener('click', function() {
  prizeIndex = 0;
  showCardsScreen();
});

var continueMadnessBtn = document.getElementById('continueMadnessBtn');
if (continueMadnessBtn) {
  continueMadnessBtn.addEventListener('click', function() {
    showCongratulationsMessage();
  });
}


cardsContainer.addEventListener('click', onCardClick);
</script>
</body>
</html>
